#pragma checksum "C:\Users\Rhys\source\repos\SmartWatts\SmartWattsUi\Pages\PowerProfile\PowerProfileChart.razor" "{ff1816ec-aa5e-4d10-87f7-6f4963833460}" "7caf70d0dc40aa493b638b53485f5f5b6406d631"
// <auto-generated/>
#pragma warning disable 1591
namespace SmartWattsUi.Pages.PowerProfile
{
    #line hidden
    using System;
    using System.Collections.Generic;
    using System.Linq;
    using System.Threading.Tasks;
    using Microsoft.AspNetCore.Components;
#nullable restore
#line 1 "C:\Users\Rhys\source\repos\SmartWatts\SmartWattsUi\_Imports.razor"
using System.Net.Http;

#line default
#line hidden
#nullable disable
#nullable restore
#line 2 "C:\Users\Rhys\source\repos\SmartWatts\SmartWattsUi\_Imports.razor"
using Microsoft.AspNetCore.Authorization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 3 "C:\Users\Rhys\source\repos\SmartWatts\SmartWattsUi\_Imports.razor"
using Microsoft.AspNetCore.Components.Authorization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 4 "C:\Users\Rhys\source\repos\SmartWatts\SmartWattsUi\_Imports.razor"
using Microsoft.AspNetCore.Components.Forms;

#line default
#line hidden
#nullable disable
#nullable restore
#line 5 "C:\Users\Rhys\source\repos\SmartWatts\SmartWattsUi\_Imports.razor"
using Microsoft.AspNetCore.Components.Routing;

#line default
#line hidden
#nullable disable
#nullable restore
#line 6 "C:\Users\Rhys\source\repos\SmartWatts\SmartWattsUi\_Imports.razor"
using Microsoft.AspNetCore.Components.Web;

#line default
#line hidden
#nullable disable
#nullable restore
#line 7 "C:\Users\Rhys\source\repos\SmartWatts\SmartWattsUi\_Imports.razor"
using Microsoft.JSInterop;

#line default
#line hidden
#nullable disable
#nullable restore
#line 8 "C:\Users\Rhys\source\repos\SmartWatts\SmartWattsUi\_Imports.razor"
using SmartWattsUi;

#line default
#line hidden
#nullable disable
#nullable restore
#line 9 "C:\Users\Rhys\source\repos\SmartWatts\SmartWattsUi\_Imports.razor"
using SmartWattsUi.Shared;

#line default
#line hidden
#nullable disable
#nullable restore
#line 3 "C:\Users\Rhys\source\repos\SmartWatts\SmartWattsUi\Pages\PowerProfile\PowerProfileChart.razor"
using SmartWattsCore.Models;

#line default
#line hidden
#nullable disable
#nullable restore
#line 4 "C:\Users\Rhys\source\repos\SmartWatts\SmartWattsUi\Pages\PowerProfile\PowerProfileChart.razor"
using SmartWattsUi.Controllers;

#line default
#line hidden
#nullable disable
#nullable restore
#line 5 "C:\Users\Rhys\source\repos\SmartWatts\SmartWattsUi\Pages\PowerProfile\PowerProfileChart.razor"
using SmartWattsCore;

#line default
#line hidden
#nullable disable
    public partial class PowerProfileChart : Microsoft.AspNetCore.Components.ComponentBase
    {
        #pragma warning disable 1998
        protected override void BuildRenderTree(Microsoft.AspNetCore.Components.Rendering.RenderTreeBuilder __builder)
        {
            __builder.OpenElement(0, "div");
            __builder.AddAttribute(1, "class", "container ride-card");
            __builder.AddMarkupContent(2, "\r\n");
            __builder.OpenElement(3, "table");
            __builder.AddMarkupContent(4, "\r\n\t");
            __builder.AddMarkupContent(5, "<tr>\r\n\t\t<th></th>\r\n\t\t<th>30 Days</th>\r\n\t\t<th></th>\r\n\t\t<th>90 Days</th>\r\n\t\t<th></th>\r\n\t\t<th>1 Year</th>\r\n\t\t<th></th>\r\n\t\t<th>All-Time</th>\r\n\t</tr>\r\n");
#nullable restore
#line 23 "C:\Users\Rhys\source\repos\SmartWatts\SmartWattsUi\Pages\PowerProfile\PowerProfileChart.razor"
     foreach (var pp in powerPoints)
	{

#line default
#line hidden
#nullable disable
            __builder.AddMarkupContent(6, "\t");
            __builder.OpenElement(7, "tr");
            __builder.AddAttribute(8, "class", (
#nullable restore
#line 25 "C:\Users\Rhys\source\repos\SmartWatts\SmartWattsUi\Pages\PowerProfile\PowerProfileChart.razor"
                 improvments.Contains(pp) ? "improvments" : ""

#line default
#line hidden
#nullable disable
            ) + " " + (
#nullable restore
#line 25 "C:\Users\Rhys\source\repos\SmartWatts\SmartWattsUi\Pages\PowerProfile\PowerProfileChart.razor"
                                                                  !improvments.Contains(pp) && LookBack != 0 ? "no-improvments" : ""

#line default
#line hidden
#nullable disable
            ));
            __builder.AddMarkupContent(9, "\r\n\t\t");
            __builder.OpenElement(10, "td");
            __builder.AddContent(11, 
#nullable restore
#line 26 "C:\Users\Rhys\source\repos\SmartWatts\SmartWattsUi\Pages\PowerProfile\PowerProfileChart.razor"
             Helpers.ConvertSecToReadable(pp)

#line default
#line hidden
#nullable disable
            );
            __builder.CloseElement();
            __builder.AddMarkupContent(12, "\r\n\t\t");
            __builder.OpenElement(13, "td");
            __builder.AddContent(14, 
#nullable restore
#line 27 "C:\Users\Rhys\source\repos\SmartWatts\SmartWattsUi\Pages\PowerProfile\PowerProfileChart.razor"
             PowerHistory30.FirstOrDefault(ph => ph.Key == pp).Value

#line default
#line hidden
#nullable disable
            );
            __builder.CloseElement();
            __builder.AddMarkupContent(15, "\r\n\t\t");
            __builder.OpenElement(16, "td");
            __builder.AddMarkupContent(17, "\r\n");
#nullable restore
#line 29 "C:\Users\Rhys\source\repos\SmartWatts\SmartWattsUi\Pages\PowerProfile\PowerProfileChart.razor"
             if (@GetPercentageOff(pp, PowerHistory90, PowerHistory30) != "0.0")
			{

#line default
#line hidden
#nullable disable
            __builder.AddMarkupContent(18, "\t\t\t\t");
            __builder.OpenElement(19, "span");
            __builder.AddAttribute(20, "class", "oi oi-arrow-thick-bottom");
            __builder.AddAttribute(21, "style", "color:" + " " + (
#nullable restore
#line 31 "C:\Users\Rhys\source\repos\SmartWatts\SmartWattsUi\Pages\PowerProfile\PowerProfileChart.razor"
                                                                      GetColor(@GetPercentageOff(pp, PowerHistory90, PowerHistory30))

#line default
#line hidden
#nullable disable
            ));
            __builder.CloseElement();
            __builder.AddMarkupContent(22, "\r\n");
#nullable restore
#line 32 "C:\Users\Rhys\source\repos\SmartWatts\SmartWattsUi\Pages\PowerProfile\PowerProfileChart.razor"
			}
			else if (PowerHistory30.FirstOrDefault(ph => ph.Key == pp).Value == 0)
			{

#line default
#line hidden
#nullable disable
            __builder.AddMarkupContent(23, "\t\t\t\t<span class=\"oi oi-thumb-down\" style=\"color: grey\"></span>\r\n");
#nullable restore
#line 36 "C:\Users\Rhys\source\repos\SmartWatts\SmartWattsUi\Pages\PowerProfile\PowerProfileChart.razor"
			}
			else
			{

#line default
#line hidden
#nullable disable
            __builder.AddMarkupContent(24, "\t\t\t\t<span class=\"oi oi-thumb-up\" style=\"color: green\"></span>\r\n");
#nullable restore
#line 40 "C:\Users\Rhys\source\repos\SmartWatts\SmartWattsUi\Pages\PowerProfile\PowerProfileChart.razor"
			}

#line default
#line hidden
#nullable disable
            __builder.AddMarkupContent(25, "\t\t\t");
            __builder.AddContent(26, 
#nullable restore
#line 41 "C:\Users\Rhys\source\repos\SmartWatts\SmartWattsUi\Pages\PowerProfile\PowerProfileChart.razor"
             GetPercentageOff(pp, PowerHistory90, PowerHistory30)

#line default
#line hidden
#nullable disable
            );
            __builder.AddMarkupContent(27, "\r\n\t\t");
            __builder.CloseElement();
            __builder.AddMarkupContent(28, "\r\n\t\t");
            __builder.OpenElement(29, "td");
            __builder.AddContent(30, 
#nullable restore
#line 43 "C:\Users\Rhys\source\repos\SmartWatts\SmartWattsUi\Pages\PowerProfile\PowerProfileChart.razor"
             PowerHistory90.FirstOrDefault(ph => ph.Key == pp).Value

#line default
#line hidden
#nullable disable
            );
            __builder.CloseElement();
            __builder.AddMarkupContent(31, "\r\n\t\t");
            __builder.OpenElement(32, "td");
            __builder.AddMarkupContent(33, "\r\n");
#nullable restore
#line 45 "C:\Users\Rhys\source\repos\SmartWatts\SmartWattsUi\Pages\PowerProfile\PowerProfileChart.razor"
             if (@GetPercentageOff(pp, PowerHistory365, PowerHistory90) != "0.0")
			{

#line default
#line hidden
#nullable disable
            __builder.AddMarkupContent(34, "\t\t\t\t");
            __builder.OpenElement(35, "span");
            __builder.AddAttribute(36, "class", "oi oi-arrow-thick-bottom");
            __builder.AddAttribute(37, "style", "color:" + " " + (
#nullable restore
#line 47 "C:\Users\Rhys\source\repos\SmartWatts\SmartWattsUi\Pages\PowerProfile\PowerProfileChart.razor"
                                                                      GetColor(@GetPercentageOff(pp, PowerHistory365, PowerHistory90))

#line default
#line hidden
#nullable disable
            ));
            __builder.CloseElement();
            __builder.AddMarkupContent(38, "\r\n");
#nullable restore
#line 48 "C:\Users\Rhys\source\repos\SmartWatts\SmartWattsUi\Pages\PowerProfile\PowerProfileChart.razor"
			}
			else if (PowerHistory90.FirstOrDefault(ph => ph.Key == pp).Value == 0)
			{

#line default
#line hidden
#nullable disable
            __builder.AddMarkupContent(39, "\t\t\t\t<span class=\"oi oi-thumb-down\" style=\"color: grey\"></span>\r\n");
#nullable restore
#line 52 "C:\Users\Rhys\source\repos\SmartWatts\SmartWattsUi\Pages\PowerProfile\PowerProfileChart.razor"
			}
			else
			{

#line default
#line hidden
#nullable disable
            __builder.AddMarkupContent(40, "\t\t\t\t<span class=\"oi oi-thumb-up\" style=\"color: green\"></span>\r\n");
#nullable restore
#line 56 "C:\Users\Rhys\source\repos\SmartWatts\SmartWattsUi\Pages\PowerProfile\PowerProfileChart.razor"
			}

#line default
#line hidden
#nullable disable
            __builder.AddMarkupContent(41, "\t\t\t");
            __builder.AddContent(42, 
#nullable restore
#line 57 "C:\Users\Rhys\source\repos\SmartWatts\SmartWattsUi\Pages\PowerProfile\PowerProfileChart.razor"
             GetPercentageOff(pp, PowerHistory365, PowerHistory90)

#line default
#line hidden
#nullable disable
            );
            __builder.AddMarkupContent(43, "\r\n\t\t");
            __builder.CloseElement();
            __builder.AddMarkupContent(44, "\r\n\t\t");
            __builder.OpenElement(45, "td");
            __builder.AddContent(46, 
#nullable restore
#line 59 "C:\Users\Rhys\source\repos\SmartWatts\SmartWattsUi\Pages\PowerProfile\PowerProfileChart.razor"
             PowerHistory365.FirstOrDefault(ph => ph.Key == pp).Value

#line default
#line hidden
#nullable disable
            );
            __builder.CloseElement();
            __builder.AddMarkupContent(47, "\r\n\t\t");
            __builder.OpenElement(48, "td");
            __builder.AddMarkupContent(49, "\r\n");
#nullable restore
#line 61 "C:\Users\Rhys\source\repos\SmartWatts\SmartWattsUi\Pages\PowerProfile\PowerProfileChart.razor"
             if (@GetPercentageOff(pp, PowerHistoryAll, PowerHistory365) != "0.0")
			{

#line default
#line hidden
#nullable disable
            __builder.AddMarkupContent(50, "\t\t\t\t");
            __builder.OpenElement(51, "span");
            __builder.AddAttribute(52, "class", "oi oi-arrow-thick-bottom");
            __builder.AddAttribute(53, "style", "color:" + " " + (
#nullable restore
#line 63 "C:\Users\Rhys\source\repos\SmartWatts\SmartWattsUi\Pages\PowerProfile\PowerProfileChart.razor"
                                                                      GetColor(@GetPercentageOff(pp, PowerHistoryAll, PowerHistory365))

#line default
#line hidden
#nullable disable
            ));
            __builder.CloseElement();
            __builder.AddMarkupContent(54, "\r\n");
#nullable restore
#line 64 "C:\Users\Rhys\source\repos\SmartWatts\SmartWattsUi\Pages\PowerProfile\PowerProfileChart.razor"
			}
			else if (PowerHistory365.FirstOrDefault(ph => ph.Key == pp).Value == 0)
			{

#line default
#line hidden
#nullable disable
            __builder.AddMarkupContent(55, "\t\t\t\t<span class=\"oi oi-thumb-down\" style=\"color: grey\"></span>\r\n");
#nullable restore
#line 68 "C:\Users\Rhys\source\repos\SmartWatts\SmartWattsUi\Pages\PowerProfile\PowerProfileChart.razor"
			}
			else
			{

#line default
#line hidden
#nullable disable
            __builder.AddMarkupContent(56, "\t\t\t\t<span class=\"oi oi-thumb-up\" style=\"color: green\"></span>\r\n");
#nullable restore
#line 72 "C:\Users\Rhys\source\repos\SmartWatts\SmartWattsUi\Pages\PowerProfile\PowerProfileChart.razor"
			}

#line default
#line hidden
#nullable disable
            __builder.AddMarkupContent(57, "\t\t\t");
            __builder.AddContent(58, 
#nullable restore
#line 73 "C:\Users\Rhys\source\repos\SmartWatts\SmartWattsUi\Pages\PowerProfile\PowerProfileChart.razor"
             GetPercentageOff(pp, PowerHistoryAll, PowerHistory365)

#line default
#line hidden
#nullable disable
            );
            __builder.AddMarkupContent(59, "\r\n\t\t");
            __builder.CloseElement();
            __builder.AddMarkupContent(60, "\r\n\t\t");
            __builder.OpenElement(61, "td");
            __builder.AddContent(62, 
#nullable restore
#line 75 "C:\Users\Rhys\source\repos\SmartWatts\SmartWattsUi\Pages\PowerProfile\PowerProfileChart.razor"
             PowerHistoryAll.FirstOrDefault(ph => ph.Key == pp).Value

#line default
#line hidden
#nullable disable
            );
            __builder.CloseElement();
            __builder.AddMarkupContent(63, "\r\n\t");
            __builder.CloseElement();
            __builder.AddMarkupContent(64, "\r\n");
#nullable restore
#line 77 "C:\Users\Rhys\source\repos\SmartWatts\SmartWattsUi\Pages\PowerProfile\PowerProfileChart.razor"
	}

#line default
#line hidden
#nullable disable
            __builder.CloseElement();
            __builder.AddMarkupContent(65, "\r\n");
            __builder.CloseElement();
            __builder.AddMarkupContent(66, "\r\n\r\n\r\n\r\n\r\n");
            __builder.AddMarkupContent(67, @"<style>
	td:nth-child(even) {
		border: 1px black solid;
		width: 60px;
	}

	.improvments {
		animation-name: blink;
		animation-duration: 2s;
		animation-iteration-count: infinite;
	}

	.no-improvments {
		opacity: .2;
	}

	@keyframes
	blink {
		from {background-color: whitesmoke;}
		to {background-color: lightyellow;}
	}
</style>");
        }
        #pragma warning restore 1998
#nullable restore
#line 82 "C:\Users\Rhys\source\repos\SmartWatts\SmartWattsUi\Pages\PowerProfile\PowerProfileChart.razor"
       
	[Parameter]
	public List<Ride> Rides { get; set; }

	[Parameter]
	public int LookBack { get; set; }

	List<Ride> displayRides = new List<Ride>();
	IEnumerable<int> improvments;

	Dictionary<int, int> PowerHistory30 = new Dictionary<int, int>();
	Dictionary<int, int> PowerHistory90 = new Dictionary<int, int>();
	Dictionary<int, int> PowerHistory365 = new Dictionary<int, int>();
	Dictionary<int, int> PowerHistoryAll = new Dictionary<int, int>();
	List<int> powerPoints;

	protected override void OnInitialized()
	{
		if (_appState.LoggedInUser == null)
		{
			NavigationManager.NavigateTo("splash");
		}
		else
		{
			FindImprovments();
			RemoveRides();
			GetPowerHistories();
		}
	}

	private void RemoveRides()
	{
		var latestDate = Rides.Max(r => r.RideMetaData.Date);
		displayRides = Rides.Where(r => r.RideMetaData.Date <= latestDate.AddDays(-LookBack)).ToList();
	}

	private void FindImprovments()
	{
		var changes = new List<int>();

		var currentPH = _powerProfileController.GetPowerCurveHistory(Rides, DateTime.Now, 30);
		powerPoints = currentPH.Keys.ToList();
		var latestDate = Rides.Max(r => r.RideMetaData.Date);
		var previousPH = _powerProfileController.GetPowerCurveHistory(Rides,latestDate.AddMinutes(-1), 30);

		improvments = powerPoints.Where(pp => currentPH[pp] > previousPH[pp]);
	}

	private void GetPowerHistories()
	{
		PowerHistory30 = _powerProfileController.GetPowerCurveHistory(displayRides, DateTime.Now, 30);
		PowerHistory90 = _powerProfileController.GetPowerCurveHistory(displayRides, DateTime.Now, 90);
		PowerHistory365 = _powerProfileController.GetPowerCurveHistory(displayRides, DateTime.Now, 365);
		PowerHistoryAll = _powerProfileController.GetPowerCurveHistory(displayRides, DateTime.Now, 9999);
	}

	private string GetPercentageOff(int powerPoint, Dictionary<int, int> powerHistoryOld, Dictionary<int, int> powerHistoryNew)
	{
		var newValue = powerHistoryNew.FirstOrDefault(ph => ph.Key == powerPoint).Value;
		var oldValue = powerHistoryOld.FirstOrDefault(ph => ph.Key == powerPoint).Value;

		var diff = (((float)newValue / oldValue) - 1) * 100;

		if (oldValue == 0)
		{
			return "0.0";
		}

		return (Math.Abs(diff)).ToString("0.0");
	}

	private string GetColor(string powerDiff)
	{
		var power = float.Parse(powerDiff);

		if (power < .1)
		{
			return "green";
		}
		else if (power >= .1 && power <= 5.0)
		{
			return "yellow";
		}
		else if (power > 5.0 && power <= 10.0)
		{
			return "orange";
		}
		else
		{
			return "red";
		}
	}


#line default
#line hidden
#nullable disable
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private PowerProfileController _powerProfileController { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private AppState _appState { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private NavigationManager NavigationManager { get; set; }
    }
}
#pragma warning restore 1591
